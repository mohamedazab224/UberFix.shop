# ๐ ูุธุงู SLA - ุฏููู ุงูุชูุนูู ูุงูุงุณุชุฎุฏุงู

## โ ุชู ุงูุชูุนูู ุจูุฌุงุญ

ุชู ุชูุนูู ูุธุงู SLA (Service Level Agreement) ุจุงููุงูู ูุน ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ูุงูุฅุดุนุงุฑุงุช.

---

## ๐ฏ ุงููููุฒุงุช ุงููููุนููุฉ

### 1. โ ุญุณุงุจ SLA ุชููุงุฆูุงู
- ูุชู ุญุณุงุจ ุฃููุงุช SLA ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ูู ุทูุจ ุตูุงูุฉ
- **3 ููุงุนูุฏ ููุงุฆูุฉ** ููู ุทูุจ:
  - **ููุนุฏ ุงููุจูู** (sla_accept_due): ููุช ูุจูู ุงูุทูุจ
  - **ููุนุฏ ุงููุตูู** (sla_arrive_due): ููุช ูุตูู ุงูููู ูููููุน
  - **ููุนุฏ ุงูุฅูุฌุงุฒ** (sla_complete_due): ููุช ุฅูุฌุงุฒ ุงูุทูุจ

### 2. โ ุฃููุงุช SLA ุญุณุจ ุงูุฃููููุฉ

| ุงูุฃููููุฉ | ููุนุฏ ุงููุจูู | ููุนุฏ ุงููุตูู | ููุนุฏ ุงูุฅูุฌุงุฒ |
|---------|-------------|-------------|--------------|
| **High** | ุณุงุนุฉ ูุงุญุฏุฉ | ุณุงุนุชูู | 8 ุณุงุนุงุช |
| **Medium** | ุณุงุนุชูู | 4 ุณุงุนุงุช | 24 ุณุงุนุฉ |
| **Low** | 4 ุณุงุนุงุช | 8 ุณุงุนุงุช | 48 ุณุงุนุฉ |

### 3. โ Edge Function ูููุฑุงูุจุฉ
- **ุงูููู**: `supabase/functions/sla-monitor/index.ts`
- **ุงููุธููุฉ**: 
  - ูุญุต ุฌููุน ุงูุทูุจุงุช ุงููุดุทุฉ
  - ุฑุตุฏ ุชุฌุงูุฒุงุช SLA
  - ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
  - ุชุณุฌูู ุฃุญุฏุงุซ ุงูุชุฌุงูุฒ

### 4. โ ูููู SLA Status Badge
- **ุงูููู**: `src/components/maintenance/SLAStatusBadge.tsx`
- **ุงูุนุฑุถ**:
  - ๐ข ุฃุฎุถุฑ: ุฃูุซุฑ ูู ููู ูุชุจูู
  - ๐ต ุฃุฒุฑู: ุฃูู ูู 24 ุณุงุนุฉ
  - ๐ก ุฃุตูุฑ: ุฃูู ูู ุณุงุนุฉ
  - ๐ด ุฃุญูุฑ: ูุชุฃุฎุฑ

### 5. โ ููุญุฉ SLA Dashboard
- **ุงููุณุงุฑ**: `/sla-dashboard`
- **ุงูููู**: `src/pages/SLADashboard.tsx`
- **ุงููุญุชูู**:
  - ุฅุญุตุงุฆูุงุช SLA ุงูููุฑูุฉ
  - ูุงุฆูุฉ ุงูุชุฌุงูุฒุงุช
  - ูุนุฏู ุงูุงูุชุฒุงู
  - ุชุญุฏูุซ ุชููุงุฆู ูู ุฏูููุฉ

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุงููุตูู ูููุญุฉ SLA
```
ุงูุชุญ: https://your-app.com/sla-dashboard
```

### 2. ุฅุถุงูุฉ Badge ูู ููุงุฆู ุงูุทูุจุงุช
```typescript
import { SLAStatusBadge } from "@/components/maintenance/SLAStatusBadge";

<SLAStatusBadge 
  dueDate={request.sla_complete_due}
  status={request.status}
  label="ุฅูุฌุงุฒ"
/>
```

### 3. ุชุดุบูู ุงููุฑุงูุจุฉ ุงููุฏููุงู
```bash
# ุงุณุชุฏุนุงุก Edge Function
curl -X POST https://zrrffsjbfkphridqyais.supabase.co/functions/v1/sla-monitor \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

---

## โฐ ุฅุนุฏุงุฏ ุงููุฑุงูุจุฉ ุงูุฏูุฑูุฉ (Cron Job)

### ุงูุฎุทูุฉ 1: ุชูุนูู Extensions
ูู ุจุชุดุบูู SQL ุงูุชุงูู ูู Supabase SQL Editor:

```sql
-- ุชูุนูู pg_cron
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- ุชูุนูู pg_net
CREATE EXTENSION IF NOT EXISTS pg_net;
```

### ุงูุฎุทูุฉ 2: ุฅูุดุงุก Cron Job
ูู ุจุชุดุบูู SQL ุงูุชุงูู (ุงุณุชุจุฏู YOUR_ANON_KEY ุจููุชุงุญ Anon ุงููุนูู):

```sql
-- ุฌุฏููุฉ ุงููุฑุงูุจุฉ ูู 5 ุฏูุงุฆู
SELECT cron.schedule(
  'sla-monitor-every-5-min',
  '*/5 * * * *', -- ูู 5 ุฏูุงุฆู
  $$
  SELECT net.http_post(
    url:='https://zrrffsjbfkphridqyais.supabase.co/functions/v1/sla-monitor',
    headers:='{"Content-Type": "application/json", "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpycmZmc2piZmtwaHJpZHF5YWlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0MzE1NzMsImV4cCI6MjA3MjAwNzU3M30.AwzY48mSUGeopBv5P6gzAPlipTbQasmXK8DR-L_Tm9A"}'::jsonb,
    body:=concat('{"time": "', now(), '"}')::jsonb
  ) as request_id;
  $$
);
```

### ุงูุชุญูู ูู Cron Job
```sql
-- ุนุฑุถ ุฌููุน Cron Jobs
SELECT * FROM cron.job;

-- ุญุฐู Cron Job (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
SELECT cron.unschedule('sla-monitor-every-5-min');
```

---

## ๐ ุงูุจูุงูุงุช ุงูููุฎุฒููุฉ

### ุฌุฏูู maintenance_requests
```sql
-- ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ
sla_accept_due   timestamptz  -- ุงูููุนุฏ ุงูููุงุฆู ูููุจูู
sla_arrive_due   timestamptz  -- ุงูููุนุฏ ุงูููุงุฆู ูููุตูู
sla_complete_due timestamptz  -- ุงูููุนุฏ ุงูููุงุฆู ููุฅูุฌุงุฒ
```

### ุฌุฏูู request_events
ูุชู ุชุณุฌูู ุฃุญุฏุงุซ ุงูุชุฌุงูุฒ:
```json
{
  "event_type": "sla_violation",
  "meta": {
    "violation_type": "complete",
    "due_date": "2025-11-09T20:00:00Z",
    "minutes_overdue": 120,
    "detected_at": "2025-11-09T22:00:00Z"
  }
}
```

### ุฌุฏูู notifications
ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ุนูุฏ ุงูุชุฌุงูุฒ:
```json
{
  "title": "โ๏ธ ุชุฌุงูุฒ SLA - ุทูุจ #a1b2c3d4",
  "message": "ุชุฃุฎุฑ ูู ุฅูุฌุงุฒ ุงูุทูุจ: ุชุฃุฎุฑ 120 ุฏูููุฉ ุนู ุงูููุนุฏ ุงููุญุฏุฏ",
  "type": "warning"
}
```

---

## ๐ง ุงูุชุฎุตูุต

### ุชุนุฏูู ุฃููุงุช SLA
ุนุฏูู ุงูุฏุงูุฉ `auto_calculate_sla` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
CREATE OR REPLACE FUNCTION public.auto_calculate_sla()
...
  CASE NEW.priority
    WHEN 'high' THEN
      accept_hours := 0.5;  -- ูุตู ุณุงุนุฉ ููุญุงูุงุช ุงูุนุงุฌูุฉ
      arrive_hours := 1;
      complete_hours := 4;
  ...
```

### ุชุนุฏูู ุชุฑุฏุฏ ุงููุฑุงูุจุฉ
ุบููุฑ Cron Schedule:
```sql
'*/15 * * * *'  -- ูู 15 ุฏูููุฉ
'0 * * * *'     -- ูู ุณุงุนุฉ
'*/30 * * * *'  -- ูู 30 ุฏูููุฉ
```

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก

### ูุนุฏู ุงูุงูุชุฒุงู ุจู SLA
```
ูุนุฏู ุงูุงูุชุฒุงู = (ุงูุทูุจุงุช ูู ุงูููุช ุงููุญุฏุฏ / ุฅุฌูุงูู ุงูุทูุจุงุช) ร 100
```

### ุงูุชุฌุงูุฒุงุช ุญุณุจ ุงูููุน
- ุชุฃุฎุฑ ุงููุจูู
- ุชุฃุฎุฑ ุงููุตูู
- ุชุฃุฎุฑ ุงูุฅูุฌุงุฒ

### ุงูุชุฌุงูุฒุงุช ุญุณุจ ุงูุฃููููุฉ
- High
- Medium
- Low

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุทูุจุงุช ุงูููุฌูุฏุฉ**: ุชู ุชุญุฏูุซ ุฌููุน ุงูุทูุจุงุช ุงูููุฌูุฏุฉ ุจุฃููุงุช SLA ุงูุชุฑุงุถูุฉ
2. **ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ**: ูุชู ุญุณุงุจ SLA ุชููุงุฆูุงู ุนูุฏ ุงูุฅูุดุงุก
3. **ุงูุทูุจุงุช ุงูููุชููุฉ**: ูุง ุชูุนุฑุถ ูู ููุญุฉ SLA
4. **ุงูุชูุจููุงุช**: ุชูุฑุณู ููุนููู ุงูุฐู ุฃูุดุฃ ุงูุทูุจ

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1. โ **ุฅุถุงูุฉ SLA Badge** ูุฌููุน ููุงุฆู ุงูุทูุจุงุช
2. โ **ุฅุถุงูุฉ ุฑุงุจุท ููุญุฉ SLA** ูู Sidebar
3. โฐ **ุชูุนูู Cron Job** ูููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ
4. ๐ง **ุฏูุฌ ุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**
5. ๐ฑ **ุฏูุฌ ุฅุดุนุงุฑุงุช SMS/WhatsApp**

---

## ๐ ุงูุฑูุงุจุท ุงููููุฏุฉ

- **ููุญุฉ SLA**: `/sla-dashboard`
- **ุชูุฑูุฑ ุงูุฅูุชุงุฌ**: `/production-report`
- **ูุฑุงูุจ ุงูุฅูุชุงุฌ**: `/production-monitor`
- **Supabase Functions**: https://supabase.com/dashboard/project/zrrffsjbfkphridqyais/functions

---

**ุงูุชุงุฑูุฎ**: 2025-11-09  
**ุงูุญุงูุฉ**: โ ูููุนูู ููุนูู
**ุงูุฅุตุฏุงุฑ**: 1.0.0
